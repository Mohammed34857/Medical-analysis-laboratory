<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Analysis Result Page - Company of Management Labs</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="CSS/Analysis_result.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css">


</head>
<body>
    <div class="result-head">
        <div class="heavenly" id="tel">
            <p>Tel: <strong>+963 348 643 467 <br> <br> +963 (021) 33 555 76 </strong></p>
            <p>info@<strong>Kabbewar-lab.com</strong></p>
            <p>http://<strong>www.Kabbewar-lab.com</strong></p>
         </div>
        <div id="contact">
            <p style="padding:10px; background-color:rgba(234, 235, 146, 0.753);">Contact persons:</p>
            <p>Dr.Kamel Kabbewar</p>
            <p>Dr.Mostafa Kabbewar</p>
            <p>Dr.med Noman</p>
         </div>
         <div class="heavenly" id="heavenly"></div>
         <div class="color" id="orange"></div>
         <div class="color" id="green"></div>
         <div class="color" id="yellow"></div>
         <div class="heavenly" id="addres">
          <h2>molecular diagnostic & genetic</h2>
          <h2>ALEPPO,SYRIA</h2>
         </div>
        <div id="container">
           <p>Doctor : <strong id="Doctor"> </strong></p>
           <p>Patient : <strong id="Patient"> </strong></p>
           <p>date : <strong id="date"> </strong></p>
        </div>
       
    </div>

  <h1>Medical Analysis Results</h1>
  
  <table id="analysisTable">
    <thead>
      <tr>
        <th>Test Name</th>
        <th>Result</th>
        <th>Reference Range</th>
      </tr>
    </thead>
    <tbody id="table">
     
    </tbody>
  </table>
  <button onclick="printPage()" class="print"><i class="fa-solid fa-print fa-xl"></i></i></button>
  
</body>
<script src="java-script/jj.js"></script>
<script> 
window.onload = function showItemInfo() {
    const urlParams = new URLSearchParams(window.location.search);
    const analysis_demand_id= urlParams.get('id');
    const doctor = document.getElementById("Doctor");
    const patient = document.getElementById("Patient");
    const date = document.getElementById("date");
  fetch(`https://testbyad.adaptable.app/analysis-demand/${analysis_demand_id}`)  
  .then(response => response.json())
  .then(data => {
    date.textContent = data.date_analays;
    const LabAnaPartana_id = data.id_LabAnaPartana;
    const Medical_referral_id = data.id_MedicalReferral;    
  fetch(`https://testbyad.adaptable.app/medical-referral/${Medical_referral_id}`)
  .then(response => response.json())
  .then(data => {
   const doctor_id = data.id_Doctor;
   const patient_id = data.id_Patient;
   fetch(`https://testbyad.adaptable.app/patient/${patient_id}`)
   .then(response => response.json())
  .then(data => {
    patient.textContent = data.name;
   fetch(`https://testbyad.adaptable.app/doctor/${doctor_id}`)
   .then(response => response.json())
  .then(data => {
    doctor.textContent = data.name;
      })
     })
   })
  })
  const table = document.getElementById('table');
  fetch(`https://testbyad.adaptable.app/analysis-demand/${analysis_demand_id}`)  
  .then(response => response.json())
  .then(data => {
    const LabAnaPartana_id = data.id_LabAnaPartana;
  fetch(`https://testbyad.adaptable.app/lab-ana-partana/${LabAnaPartana_id}`)
  .then(response => response.json())
  .then(data =>{
    const AnaPartanalysis_id = data.id_AnaPartanalysis;
    fetch(`https://testbyad.adaptable.app/ana-partanalysis/${AnaPartanalysis_id}`)
  .then(response => response.json())
  .then(data =>{
    const partial_analysis_id = data.id_partial_analysis;
    const analysis_id = data.id_anaylsis;
   
   fetch(`https://testbyad.adaptable.app/analysis/${analysis_id}`)
    .then(response => response.json())
    .then(data =>{
    const Item = document.createElement('tr');
    table.appendChild(Item);

    const Item1 = document.createElement('td');
    const idCellText = document.createTextNode(data.name_analysis);
    Item1.style.fontWeight = "bold";
    Item1.style.textDecoration = "underline";
    Item1.appendChild(idCellText);
    Item.appendChild(Item1);

    fetch(`https://testbyad.adaptable.app/ana-partanalysis`)
  .then(response => response.json())
  .then(data =>{
   const analysis = data.filter( data => data.id_anaylsis === analysis_id);
 
   fetch(`https://testbyad.adaptable.app/analysis-demand/${analysis_demand_id}`)  
  .then(response => response.json())
  .then(data => {
    const MedicalReferral_id = data.id_MedicalReferral;
    fetch(`https://testbyad.adaptable.app/analysis-demand`)  
  .then(response => response.json())
  .then(data => {
    const result = data.filter( data => data.id_MedicalReferral === MedicalReferral_id);

    for (let i = 0; i < analysis.length; i++) {
    const ana = analysis[i];
    const partial_analysis_id = ana.id_partial_analysis;
    fetch(`https://testbyad.adaptable.app/partial-analysis/${partial_analysis_id}`)
  .then(response => response.json())
  .then(data =>{
    const Item = document.createElement('tr');
    table.appendChild(Item);
    const Item1 = document.createElement('td');
    const idCellText1 = document.createTextNode(data.name_part_ana);
    Item1.appendChild(idCellText1);
    Item.appendChild(Item1);

    const res = result[i];
    const Item2 = document.createElement('td');
    const idCellText2 = document.createTextNode(res.result);
    Item2.appendChild(idCellText2);
    Item.appendChild(Item2);

    const Item3 = document.createElement('td');
    const idCellText3 = document.createTextNode(data.normal_level);
    Item3.appendChild(idCellText3);
    Item.appendChild(Item3);
     }) 
     }
    })
   })
   })
  })
  })
 })
})


}
</script>

</html>
